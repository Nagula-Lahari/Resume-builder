<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Resume Builder Pro</title>
  <!-- React & React DOM -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Babel for JSX -->
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <!-- jsPDF for PDF generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- html2canvas for PDF generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  
  <style id="app-style">
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f5f7fa;
    }
    
    /* Print styles for resume preview */
    @media print {
      .print-only {
        display: block;
      }
      .no-print {
        display: none;
      }
    }
    
    /* Resume preview styling */
    .resume-preview {
      font-family: 'Inter', sans-serif;
      color: #333;
      line-height: 1.5;
    }
    
    .resume-preview h1 {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 4px;
    }
    
    .resume-preview h2 {
      font-size: 18px;
      font-weight: 600;
      margin-top: 16px;
      margin-bottom: 8px;
      border-bottom: 1px solid #e2e8f0;
      padding-bottom: 4px;
    }
    
    .resume-preview .section {
      margin-bottom: 16px;
    }
    
    .resume-preview .experience-item,
    .resume-preview .education-item {
      margin-bottom: 12px;
    }
    
    .resume-preview .job-title,
    .resume-preview .degree {
      font-weight: 600;
    }
    
    .resume-preview .company,
    .resume-preview .school {
      font-weight: 500;
    }
    
    .resume-preview .period {
      font-style: italic;
      color: #64748b;
      font-size: 14px;
    }
    
    .resume-preview .skills-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    
    .resume-preview .skill-item {
      background-color: #f1f5f9;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 14px;
    }
    
    /* Animation for AI suggestion */
    @keyframes pulse {
      0% {
        opacity: 0.6;
      }
      50% {
        opacity: 1;
      }
      100% {
        opacity: 0.6;
      }
    }
    
    .ai-suggestion-loading {
      animation: pulse 1.5s infinite;
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f5f9;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }
    
    /* Tooltip styles */
    .tooltip {
      position: relative;
    }
    
    .tooltip .tooltiptext {
      visibility: hidden;
      width: 200px;
      background-color: #1e293b;
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 8px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }
    
    /* Progress bar animation */
    @keyframes fillProgress {
      from {
        width: 0;
      }
      to {
        width: 100%;
      }
    }
    
    .progress-fill {
      animation: fillProgress 0.5s ease-out;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel" id="app-script">
    // Define constants
    const SECTIONS = [
      { id: 'personal', label: 'Personal Info' },
      { id: 'experience', label: 'Experience' },
      { id: 'education', label: 'Education' },
      { id: 'skills', label: 'Skills' },
      { id: 'summary', label: 'Summary' }
    ];
    
    // Root App Component
    const App = () => {
      const [currentSection, setCurrentSection] = React.useState(SECTIONS[0].id);
      const [formData, setFormData] = React.useState(() => {
        const savedData = localStorage.getItem('resumeData');
        return savedData ? JSON.parse(savedData) : {
          personal: {
            fullName: '',
            email: '',
            phone: '',
            location: '',
          },
          experience: [
            { id: 1, title: '', company: '', location: '', startDate: '', endDate: '', description: '' }
          ],
          education: [
            { id: 1, degree: '', school: '', location: '', startDate: '', endDate: '', description: '' }
          ],
          skills: {
            skillsList: '',
          },
          summary: {
            professionalSummary: '',
          }
        };
      });
      const [aiSuggestions, setAiSuggestions] = React.useState({});
      const [loadingAi, setLoadingAi] = React.useState({});
      const [showAiPanel, setShowAiPanel] = React.useState({});
      const [exportMode, setExportMode] = React.useState(false);
      const [validationErrors, setValidationErrors] = React.useState({});
      
      // Get section index for progress calculation
      const getSectionIndex = (sectionId) => {
        return SECTIONS.findIndex(section => section.id === sectionId);
      };
      
      // Calculate progress percentage
      const calculateProgress = () => {
        const currentIndex = getSectionIndex(currentSection);
        return ((currentIndex + 1) / SECTIONS.length) * 100;
      };
      
      // Handler for section navigation
      const handleSectionChange = (sectionId) => {
        setCurrentSection(sectionId);
      };
      
      // Handle form field changes with auto-save and validation
      const handleChange = (section, field, value, id = null) => {
        // Perform validation
        let error = null;
        
        // Email validation
        if (field === 'email') {
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (value && !emailRegex.test(value)) {
            error = 'Please enter a valid email address';
          }
        }
        
        // Required field validation
        if ((field === 'fullName' || field === 'email') && !value.trim()) {
          error = `${field === 'fullName' ? 'Full Name' : 'Email'} is required`;
        }
        
        // Update validation errors
        const key = id !== null ? `${section}.${field}.${id}` : `${section}.${field}`;
        
        setValidationErrors(prev => ({
          ...prev,
          [key]: error
        }));
        
        // Update form data
        setFormData(prevData => {
          let newData;
          if (id !== null) {
            // For array fields like experience or education
            const newSectionData = [...prevData[section]];
            const itemIndex = newSectionData.findIndex(item => item.id === id);
            if (itemIndex !== -1) {
              newSectionData[itemIndex] = {
                ...newSectionData[itemIndex],
                [field]: value
              };
            }
            newData = { ...prevData, [section]: newSectionData };
          } else {
            // For object fields
            newData = {
              ...prevData,
              [section]: {
                ...prevData[section],
                [field]: value
              }
            };
          }
          
          // Auto-save to localStorage
          localStorage.setItem('resumeData', JSON.stringify(newData));
          
          return newData;
        });
      };
      
      // Add new item to arrays (experience, education)
      const addItem = (section) => {
        setFormData(prevData => {
          const newId = prevData[section].length > 0 
            ? Math.max(...prevData[section].map(item => item.id)) + 1 
            : 1;
          
          const newItem = section === 'experience' 
            ? { id: newId, title: '', company: '', location: '', startDate: '', endDate: '', description: '' }
            : { id: newId, degree: '', school: '', location: '', startDate: '', endDate: '', description: '' };
          
          return {
            ...prevData,
            [section]: [...prevData[section], newItem]
          };
        });
      };
      
      // Remove item from arrays
      const removeItem = (section, id) => {
        setFormData(prevData => {
          return {
            ...prevData,
            [section]: prevData[section].filter(item => item.id !== id)
          };
        });
      };
      
      // Request AI suggestion
      const requestAiSuggestion = (section, field, id = null) => {
        const loadingKey = id !== null ? `${section}.${field}.${id}` : `${section}.${field}`;
        setLoadingAi({ ...loadingAi, [loadingKey]: true });
        
        // Real API call to ResumeImprove Loop
        (async () => {
          const suggestionKey = id !== null ? `${section}.${field}.${id}` : `${section}.${field}`;
          // Determine loop section name mapping if needed
          const loopSection = section === 'experience' ? 'work_experience' : section;
          // Grab current field content
          const content = id !== null
            ? formData[section].find(item => item.id === id)[field] || ''
            : formData[section][field];
          
          try {
            const response = await fetch(
              'https://magicloops.dev/api/loop/1d239c4b-4888-48e8-bc67-46f9999f276d/run',
              {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ section: loopSection, content }),
              }
            );
            const json = await response.json();
            // Assume API returns an array of suggestions
            const firstSuggestion = Array.isArray(json.suggestions)
              ? json.suggestions[0]
              : json.suggestions;
            
            setAiSuggestions(prev => ({
              ...prev,
              [suggestionKey]: firstSuggestion || 'No suggestions returned.',
            }));
          } catch (err) {
            setAiSuggestions(prev => ({
              ...prev,
              [suggestionKey]: 'Error fetching suggestion.',
            }));
          } finally {
            setLoadingAi(prev => ({ ...prev, [loadingKey]: false }));
            setShowAiPanel(prev => ({ ...prev, [loadingKey]: true }));
          }
        })();
      };
      
      // Accept AI suggestion
      const acceptSuggestion = (section, field, id = null) => {
        const suggestionKey = id !== null ? `${section}.${field}.${id}` : `${section}.${field}`;
        if (aiSuggestions[suggestionKey]) {
          handleChange(section, field, aiSuggestions[suggestionKey], id);
          // Close the panel after accepting
          setShowAiPanel({ ...showAiPanel, [suggestionKey]: false });
        }
      };
      
      // Save draft to localStorage
      const saveDraft = () => {
        localStorage.setItem('resumeData', JSON.stringify(formData));
        alert('Resume draft saved successfully!');
      };
      
      // Clear all data and start over
      const startOver = () => {
        if (confirm('Are you sure you want to clear all data and start over?')) {
          localStorage.removeItem('resumeData');
          setFormData({
            personal: {
              fullName: '',
              email: '',
              phone: '',
              location: '',
            },
            experience: [
              { id: 1, title: '', company: '', location: '', startDate: '', endDate: '', description: '' }
            ],
            education: [
              { id: 1, degree: '', school: '', location: '', startDate: '', endDate: '', description: '' }
            ],
            skills: {
              skillsList: '',
            },
            summary: {
              professionalSummary: '',
            }
          });
        }
      };
      
      // Export to PDF
      const exportToPdf = () => {
        setExportMode(true);
        
        // Allow time for the DOM to update before capturing
        setTimeout(() => {
          const { jsPDF } = window.jspdf;
          
          const resumeElement = document.getElementById('resume-preview');
          
          html2canvas(resumeElement, {
            scale: 2,
            useCORS: true,
            logging: false
          }).then(canvas => {
            const imgData = canvas.toDataURL('image/png');
            
            // A4 dimensions in mm
            const pdf = new jsPDF('p', 'mm', 'a4');
            const pdfWidth = pdf.internal.pageSize.getWidth();
            const pdfHeight = pdf.internal.pageSize.getHeight();
            
            const imgWidth = canvas.width;
            const imgHeight = canvas.height;
            
            const ratio = Math.min(pdfWidth / imgWidth, pdfHeight / imgHeight);
            
            const imgX = (pdfWidth - imgWidth * ratio) / 2;
            const imgY = 10;
            
            pdf.addImage(imgData, 'PNG', imgX, imgY, imgWidth * ratio, imgHeight * ratio);
            pdf.save('resume.pdf');
            
            setExportMode(false);
          });
        }, 500);
      };
      
      // Render form based on current section
      const renderForm = () => {
        switch (currentSection) {
          case 'personal':
            return (
              <div className="space-y-4">
                <h2 className="text-xl font-semibold">Personal Information</h2>
                <FormField
                  label="Full Name"
                  type="text"
                  value={formData.personal.fullName}
                  onChange={(value) => handleChange('personal', 'fullName', value)}
                  placeholder="e.g., John Smith"
                  section="personal"
                  field="fullName"
                  aiSuggestions={aiSuggestions}
                  loadingAi={loadingAi}
                  showAiPanel={showAiPanel}
                  requestAiSuggestion={requestAiSuggestion}
                  acceptSuggestion={acceptSuggestion}
                  setShowAiPanel={setShowAiPanel}
                />
                <FormField
                  label="Email"
                  type="email"
                  value={formData.personal.email}
                  onChange={(value) => handleChange('personal', 'email', value)}
                  placeholder="e.g., john.smith@example.com"
                  section="personal"
                  field="email"
                  aiSuggestions={aiSuggestions}
                  loadingAi={loadingAi}
                  showAiPanel={showAiPanel}
                  requestAiSuggestion={requestAiSuggestion}
                  acceptSuggestion={acceptSuggestion}
                  setShowAiPanel={setShowAiPanel}
                />
                <FormField
                  label="Phone"
                  type="tel"
                  value={formData.personal.phone}
                  onChange={(value) => handleChange('personal', 'phone', value)}
                  placeholder="e.g., (555) 123-4567"
                  section="personal"
                  field="phone"
                  aiSuggestions={aiSuggestions}
                  loadingAi={loadingAi}
                  showAiPanel={showAiPanel}
                  requestAiSuggestion={requestAiSuggestion}
                  acceptSuggestion={acceptSuggestion}
                  setShowAiPanel={setShowAiPanel}
                />
                <FormField
                  label="Location"
                  type="text"
                  value={formData.personal.location}
                  onChange={(value) => handleChange('personal', 'location', value)}
                  placeholder="e.g., New York, NY"
                  section="personal"
                  field="location"
                  aiSuggestions={aiSuggestions}
                  loadingAi={loadingAi}
                  showAiPanel={showAiPanel}
                  requestAiSuggestion={requestAiSuggestion}
                  acceptSuggestion={acceptSuggestion}
                  setShowAiPanel={setShowAiPanel}
                />
              </div>
            );
          
          case 'experience':
            return (
              <div className="space-y-6">
                <div className="flex justify-between items-center">
                  <h2 className="text-xl font-semibold">Work Experience</h2>
                  <button
                    onClick={() => addItem('experience')}
                    className="px-3 py-1 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700 transition"
                  >
                    <i className="fas fa-plus mr-1"></i> Add Experience
                  </button>
                </div>
                
                {formData.experience.map((exp, index) => (
                  <div key={exp.id} className="border border-gray-200 rounded-lg p-4 bg-white">
                    <div className="flex justify-between items-center mb-3">
                      <h3 className="font-medium">Experience #{index + 1}</h3>
                      {formData.experience.length > 1 && (
                        <button
                          onClick={() => removeItem('experience', exp.id)}
                          className="text-red-500 hover:text-red-700"
                          title="Remove this experience"
                        >
                          <i className="fas fa-trash"></i>
                        </button>
                      )}
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <FormField
                        label="Job Title"
                        type="text"
                        value={exp.title}
                        onChange={(value) => handleChange('experience', 'title', value, exp.id)}
                        placeholder="e.g., Senior Developer"
                        section="experience"
                        field="title"
                        id={exp.id}
                        aiSuggestions={aiSuggestions}
                        loadingAi={loadingAi}
                        showAiPanel={showAiPanel}
                        requestAiSuggestion={requestAiSuggestion}
                        acceptSuggestion={acceptSuggestion}
                        setShowAiPanel={setShowAiPanel}
                      />
                      <FormField
                        label="Company"
                        type="text"
                        value={exp.company}
                        onChange={(value) => handleChange('experience', 'company', value, exp.id)}
                        placeholder="e.g., Tech Company Inc."
                        section="experience"
                        field="company"
                        id={exp.id}
                        aiSuggestions={aiSuggestions}
                        loadingAi={loadingAi}
                        showAiPanel={showAiPanel}
                        requestAiSuggestion={requestAiSuggestion}
                        acceptSuggestion={acceptSuggestion}
                        setShowAiPanel={setShowAiPanel}
                      />
                      <FormField
                        label="Location"
                        type="text"
                        value={exp.location}
                        onChange={(value) => handleChange('experience', 'location', value, exp.id)}
                        placeholder="e.g., New York, NY"
                        section="experience"
                        field="location"
                        id={exp.id}
                        aiSuggestions={aiSuggestions}
                        loadingAi={loadingAi}
                        showAiPanel={showAiPanel}
                        requestAiSuggestion={requestAiSuggestion}
                        acceptSuggestion={acceptSuggestion}
                        setShowAiPanel={setShowAiPanel}
                      />
                      <div className="grid grid-cols-2 gap-2">
                        <FormField
                          label="Start Date"
                          type="month"
                          value={exp.startDate}
                          onChange={(value) => handleChange('experience', 'startDate', value, exp.id)}
                          placeholder=""
                          section="experience"
                          field="startDate"
                          id={exp.id}
                          aiSuggestions={aiSuggestions}
                          loadingAi={loadingAi}
                          showAiPanel={showAiPanel}
                          requestAiSuggestion={requestAiSuggestion}
                          acceptSuggestion={acceptSuggestion}
                          setShowAiPanel={setShowAiPanel}
                          noAi={true}
                        />
                        <FormField
                          label="End Date"
                          type="month"
                          value={exp.endDate}
                          onChange={(value) => handleChange('experience', 'endDate', value, exp.id)}
                          placeholder=""
                          section="experience"
                          field="endDate"
                          id={exp.id}
                          aiSuggestions={aiSuggestions}
                          loadingAi={loadingAi}
                          showAiPanel={showAiPanel}
                          requestAiSuggestion={requestAiSuggestion}
                          acceptSuggestion={acceptSuggestion}
                          setShowAiPanel={setShowAiPanel}
                          noAi={true}
                        />
                      </div>
                    </div>
                    <div className="mt-3">
                      <FormField
                        label="Description"
                        type="textarea"
                        value={exp.description}
                        onChange={(value) => handleChange('experience', 'description', value, exp.id)}
                        placeholder="Describe your responsibilities and achievements..."
                        section="experience"
                        field="description"
                        id={exp.id}
                        aiSuggestions={aiSuggestions}
                        loadingAi={loadingAi}
                        showAiPanel={showAiPanel}
                        requestAiSuggestion={requestAiSuggestion}
                        acceptSuggestion={acceptSuggestion}
                        setShowAiPanel={setShowAiPanel}
                      />
                    </div>
                  </div>
                ))}
              </div>
            );
          
          case 'education':
            return (
              <div className="space-y-6">
                <div className="flex justify-between items-center">
                  <h2 className="text-xl font-semibold">Education</h2>
                  <button
                    onClick={() => addItem('education')}
                    className="px-3 py-1 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700 transition"
                  >
                    <i className="fas fa-plus mr-1"></i> Add Education
                  </button>
                </div>
                
                {formData.education.map((edu, index) => (
                  <div key={edu.id} className="border border-gray-200 rounded-lg p-4 bg-white">
                    <div className="flex justify-between items-center mb-3">
                      <h3 className="font-medium">Education #{index + 1}</h3>
                      {formData.education.length > 1 && (
                        <button
                          onClick={() => removeItem('education', edu.id)}
                          className="text-red-500 hover:text-red-700"
                          title="Remove this education"
                        >
                          <i className="fas fa-trash"></i>
                        </button>
                      )}
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <FormField
                        label="Degree"
                        type="text"
                        value={edu.degree}
                        onChange={(value) => handleChange('education', 'degree', value, edu.id)}
                        placeholder="e.g., Bachelor of Science in Computer Science"
                        section="education"
                        field="degree"
                        id={edu.id}
                        aiSuggestions={aiSuggestions}
                        loadingAi={loadingAi}
                        showAiPanel={showAiPanel}
                        requestAiSuggestion={requestAiSuggestion}
                        acceptSuggestion={acceptSuggestion}
                        setShowAiPanel={setShowAiPanel}
                      />
                      <FormField
                        label="School"
                        type="text"
                        value={edu.school}
                        onChange={(value) => handleChange('education', 'school', value, edu.id)}
                        placeholder="e.g., University of Technology"
                        section="education"
                        field="school"
                        id={edu.id}
                        aiSuggestions={aiSuggestions}
                        loadingAi={loadingAi}
                        showAiPanel={showAiPanel}
                        requestAiSuggestion={requestAiSuggestion}
                        acceptSuggestion={acceptSuggestion}
                        setShowAiPanel={setShowAiPanel}
                      />
                      <FormField
                        label="Location"
                        type="text"
                        value={edu.location}
                        onChange={(value) => handleChange('education', 'location', value, edu.id)}
                        placeholder="e.g., Boston, MA"
                        section="education"
                        field="location"
                        id={edu.id}
                        aiSuggestions={aiSuggestions}
                        loadingAi={loadingAi}
                        showAiPanel={showAiPanel}
                        requestAiSuggestion={requestAiSuggestion}
                        acceptSuggestion={acceptSuggestion}
                        setShowAiPanel={setShowAiPanel}
                      />
                      <div className="grid grid-cols-2 gap-2">
                        <FormField
                          label="Start Date"
                          type="month"
                          value={edu.startDate}
                          onChange={(value) => handleChange('education', 'startDate', value, edu.id)}
                          placeholder=""
                          section="education"
                          field="startDate"
                          id={edu.id}
                          aiSuggestions={aiSuggestions}
                          loadingAi={loadingAi}
                          showAiPanel={showAiPanel}
                          requestAiSuggestion={requestAiSuggestion}
                          acceptSuggestion={acceptSuggestion}
                          setShowAiPanel={setShowAiPanel}
                          noAi={true}
                        />
                        <FormField
                          label="End Date"
                          type="month"
                          value={edu.endDate}
                          onChange={(value) => handleChange('education', 'endDate', value, edu.id)}
                          placeholder=""
                          section="education"
                          field="endDate"
                          id={edu.id}
                          aiSuggestions={aiSuggestions}
                          loadingAi={loadingAi}
                          showAiPanel={showAiPanel}
                          requestAiSuggestion={requestAiSuggestion}
                          acceptSuggestion={acceptSuggestion}
                          setShowAiPanel={setShowAiPanel}
                          noAi={true}
                        />
                      </div>
                    </div>
                    <div className="mt-3">
                      <FormField
                        label="Description"
                        type="textarea"
                        value={edu.description}
                        onChange={(value) => handleChange('education', 'description', value, edu.id)}
                        placeholder="Describe your studies, achievements, relevant courses..."
                        section="education"
                        field="description"
                        id={edu.id}
                        aiSuggestions={aiSuggestions}
                        loadingAi={loadingAi}
                        showAiPanel={showAiPanel}
                        requestAiSuggestion={requestAiSuggestion}
                        acceptSuggestion={acceptSuggestion}
                        setShowAiPanel={setShowAiPanel}
                      />
                    </div>
                  </div>
                ))}
              </div>
            );
          
          case 'skills':
            return (
              <div className="space-y-4">
                <h2 className="text-xl font-semibold">Skills</h2>
                <p className="text-gray-600 text-sm">
                  List your relevant professional skills. Separate them with commas.
                </p>
                <FormField
                  label="Skills"
                  type="textarea"
                  value={formData.skills.skillsList}
                  onChange={(value) => handleChange('skills', 'skillsList', value)}
                  placeholder="e.g., JavaScript, React, Node.js, CSS, UI/UX Design"
                  section="skills"
                  field="skillsList"
                  aiSuggestions={aiSuggestions}
                  loadingAi={loadingAi}
                  showAiPanel={showAiPanel}
                  requestAiSuggestion={requestAiSuggestion}
                  acceptSuggestion={acceptSuggestion}
                  setShowAiPanel={setShowAiPanel}
                />
              </div>
            );
          
          case 'summary':
            return (
              <div className="space-y-4">
                <h2 className="text-xl font-semibold">Professional Summary</h2>
                <p className="text-gray-600 text-sm">
                  Write a brief summary highlighting your professional background, key strengths, and career goals.
                </p>
                <FormField
                  label="Professional Summary"
                  type="textarea"
                  value={formData.summary.professionalSummary}
                  onChange={(value) => handleChange('summary', 'professionalSummary', value)}
                  placeholder="e.g., Experienced web developer with 5+ years specializing in frontend technologies..."
                  section="summary"
                  field="professionalSummary"
                  aiSuggestions={aiSuggestions}
                  loadingAi={loadingAi}
                  showAiPanel={showAiPanel}
                  requestAiSuggestion={requestAiSuggestion}
                  acceptSuggestion={acceptSuggestion}
                  setShowAiPanel={setShowAiPanel}
                />
              </div>
            );
          
          default:
            return <div>Please select a section</div>;
        }
      };
      
      // Navigation buttons based on current section
      const renderNavButtons = () => {
        const currentIndex = getSectionIndex(currentSection);
        const prevSection = currentIndex > 0 ? SECTIONS[currentIndex - 1].id : null;
        const nextSection = currentIndex < SECTIONS.length - 1 ? SECTIONS[currentIndex + 1].id : null;
        
        return (
          <div className="flex justify-between mt-6">
            <button
              onClick={() => prevSection && handleSectionChange(prevSection)}
              disabled={!prevSection}
              className={`px-4 py-2 rounded-md ${
                prevSection 
                  ? 'bg-gray-200 hover:bg-gray-300 text-gray-800' 
                  : 'bg-gray-100 text-gray-400 cursor-not-allowed'
              }`}
            >
              <i className="fas fa-arrow-left mr-2"></i>
              Previous
            </button>
            
            <div className="flex space-x-2">
              <button
                onClick={saveDraft}
                className="px-4 py-2 bg-green-50 text-green-700 border border-green-200 rounded-md hover:bg-green-100 transition"
              >
                <i className="fas fa-save mr-2"></i>
                Save Draft
              </button>
              
              <button
                onClick={startOver}
                className="px-4 py-2 bg-red-50 text-red-700 border border-red-200 rounded-md hover:bg-red-100 transition"
              >
                <i className="fas fa-trash mr-2"></i>
                Start Over
              </button>
            </div>
            
            <button
              onClick={() => nextSection && handleSectionChange(nextSection)}
              disabled={!nextSection}
              className={`px-4 py-2 rounded-md ${
                nextSection 
                  ? 'bg-blue-600 hover:bg-blue-700 text-white' 
                  : 'bg-blue-200 text-blue-400 cursor-not-allowed'
              }`}
            >
              Next
              <i className="fas fa-arrow-right ml-2"></i>
            </button>
          </div>
        );
      };
      
      return (
        <div className="min-h-screen bg-gray-50 py-8">
          <div className="container mx-auto px-4">
            <header className="mb-8 text-center relative">
              <h1 className="text-3xl font-bold text-gray-800 mb-2">Resume Builder Pro</h1>
              <p className="text-gray-600">Create a professional resume in minutes with AI assistance</p>
              
              {/* Download Source Button */}
              <button 
                onClick={() => {
                  const docHtml = document.documentElement.outerHTML;
                  const blob = new Blob([docHtml], { type: 'text/html' });
                  const url = URL.createObjectURL(blob);
                  const a = document.createElement('a');
                  a.href = url;
                  a.download = 'resume-builder-pro.html';
                  document.body.appendChild(a);
                  a.click();
                  document.body.removeChild(a);
                  URL.revokeObjectURL(url);
                }}
                className="absolute top-0 right-0 px-3 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition flex items-center text-sm"
              >
                <i className="fas fa-download mr-2"></i>
                Download Source
              </button>
            </header>
            
            {/* Progress Bar */}
            <div className="mb-8 bg-white rounded-lg shadow-sm p-4">
              <div className="flex justify-between mb-2">
                {SECTIONS.map((section) => (
                  <button
                    key={section.id}
                    className={`text-sm font-medium ${
                      currentSection === section.id
                        ? 'text-blue-600'
                        : getSectionIndex(section.id) < getSectionIndex(currentSection)
                          ? 'text-green-600'
                          : 'text-gray-500'
                    }`}
                    onClick={() => handleSectionChange(section.id)}
                  >
                    {getSectionIndex(section.id) < getSectionIndex(currentSection) && (
                      <i className="fas fa-check-circle mr-1"></i>
                    )}
                    {section.label}
                  </button>
                ))}
              </div>
              
              <div className="h-2 bg-gray-200 rounded-full overflow-hidden">
                <div 
                  className="h-full bg-blue-600 rounded-full progress-fill"
                  style={{ width: `${calculateProgress()}%` }}
                ></div>
              </div>
            </div>
            
            <div className={`flex ${exportMode ? 'flex-col' : 'flex-col lg:flex-row'} gap-6`}>
              {/* Form Panel */}
              {!exportMode && (
                <div className="lg:w-1/2 bg-white rounded-lg shadow-sm p-6">
                  {renderForm()}
                  {renderNavButtons()}
                </div>
              )}
              
              {/* Preview Panel */}
              <div className={`${exportMode ? 'w-full' : 'lg:w-1/2'} bg-white rounded-lg shadow-sm p-6`}>
                <div className="flex justify-between items-center mb-4">
                  <h2 className="text-xl font-semibold">Resume Preview</h2>
                  {!exportMode && (
                    <button
                      onClick={exportToPdf}
                      className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition flex items-center"
                    >
                      <i className="fas fa-file-pdf mr-2"></i>
                      Export PDF
                    </button>
                  )}
                </div>
                
                <div 
                  id="resume-preview"
                  className="border border-gray-200 rounded-lg p-6 bg-white resume-preview"
                  style={{ minHeight: '297mm', maxWidth: '210mm', margin: '0 auto' }}
                >
                  {/* Resume Header */}
                  <div className="text-center mb-6">
                    <h1>{formData.personal.fullName || 'Your Name'}</h1>
                    <div className="flex justify-center flex-wrap gap-x-4 text-sm text-gray-600">
                      {formData.personal.email && (
                        <span><i className="fas fa-envelope mr-1"></i> {formData.personal.email}</span>
                      )}
                      {formData.personal.phone && (
                        <span><i className="fas fa-phone mr-1"></i> {formData.personal.phone}</span>
                      )}
                      {formData.personal.location && (
                        <span><i className="fas fa-map-marker-alt mr-1"></i> {formData.personal.location}</span>
                      )}
                    </div>
                  </div>
                  
                  {/* Summary Section */}
                  {formData.summary.professionalSummary && (
                    <div className="section">
                      <h2>Professional Summary</h2>
                      <p>{formData.summary.professionalSummary}</p>
                    </div>
                  )}
                  
                  {/* Experience Section */}
                  {formData.experience.some(exp => exp.title || exp.company) && (
                    <div className="section">
                      <h2>Work Experience</h2>
                      {formData.experience.map((exp, index) => (
                        (exp.title || exp.company) && (
                          <div key={index} className="experience-item">
                            <div className="flex justify-between">
                              <span className="job-title">{exp.title || 'Position'}</span>
                              <span className="period">
                                {exp.startDate && formatDate(exp.startDate)}
                                {exp.startDate && exp.endDate && ' - '}
                                {exp.endDate ? formatDate(exp.endDate) : exp.startDate ? 'Present' : ''}
                              </span>
                            </div>
                            <div className="flex justify-between">
                              <span className="company">{exp.company || 'Company'}{exp.location && `, ${exp.location}`}</span>
                            </div>
                            {exp.description && <p className="mt-1">{exp.description}</p>}
                          </div>
                        )
                      ))}
                    </div>
                  )}
                  
                  {/* Education Section */}
                  {formData.education.some(edu => edu.degree || edu.school) && (
                    <div className="section">
                      <h2>Education</h2>
                      {formData.education.map((edu, index) => (
                        (edu.degree || edu.school) && (
                          <div key={index} className="education-item">
                            <div className="flex justify-between">
                              <span className="degree">{edu.degree || 'Degree'}</span>
                              <span className="period">
                                {edu.startDate && formatDate(edu.startDate)}
                                {edu.startDate && edu.endDate && ' - '}
                                {edu.endDate ? formatDate(edu.endDate) : edu.startDate ? 'Present' : ''}
                              </span>
                            </div>
                            <div className="flex justify-between">
                              <span className="school">{edu.school || 'School'}{edu.location && `, ${edu.location}`}</span>
                            </div>
                            {edu.description && <p className="mt-1">{edu.description}</p>}
                          </div>
                        )
                      ))}
                    </div>
                  )}
                  
                  {/* Skills Section */}
                  {formData.skills.skillsList && (
                    <div className="section">
                      <h2>Skills</h2>
                      <div className="skills-list">
                        {formData.skills.skillsList.split(',').map((skill, index) => (
                          skill.trim() && (
                            <span key={index} className="skill-item">
                              {skill.trim()}
                            </span>
                          )
                        ))}
                      </div>
                    </div>
                  )}
                </div>
                
                {/* Export Mode Controls */}
                {exportMode && (
                  <div className="mt-4 text-center">
                    <button
                      onClick={() => setExportMode(false)}
                      className="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition"
                    >
                      <i className="fas fa-arrow-left mr-2"></i>
                      Back to Editor
                    </button>
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>
      );
    };
    
    // FormField Component with validation support
    const FormField = ({ 
      label, 
      type, 
      value, 
      onChange, 
      placeholder, 
      section, 
      field, 
      id = null,
      aiSuggestions,
      loadingAi,
      showAiPanel,
      requestAiSuggestion,
      acceptSuggestion,
      setShowAiPanel,
      noAi = false,
      required = false
    }) => {
      const key = id !== null ? `${section}.${field}.${id}` : `${section}.${field}`;
      const hasAiSuggestion = aiSuggestions[key];
      const isLoading = loadingAi[key];
      const isPanelOpen = showAiPanel[key];
      
      // Set required fields
      if (field === 'fullName' || field === 'email') {
        required = true;
      }
      
      // Get validation error
      const { validationErrors } = React.useContext(ValidationContext);
      const validationError = validationErrors[key];
      
      const renderInput = () => {
        if (type === 'textarea') {
          return (
            <textarea
              value={value}
              onChange={(e) => onChange(e.target.value)}
              placeholder={placeholder}
              className={`w-full px-3 py-2 border ${validationError ? 'border-red-500' : 'border-gray-300'} rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 min-h-[100px]`}
              required={required}
            />
          );
        } else {
          return (
            <input
              type={type}
              value={value}
              onChange={(e) => onChange(e.target.value)}
              placeholder={placeholder}
              className={`w-full px-3 py-2 border ${validationError ? 'border-red-500' : 'border-gray-300'} rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500`}
              required={required}
            />
          );
        }
      };
      
      return (
        <div className="space-y-1">
          <div className="flex justify-between">
            <label className="block text-sm font-medium text-gray-700">
              {label} {required && <span className="text-red-500">*</span>}
            </label>
            {!noAi && (
              <button
                onClick={() => requestAiSuggestion(section, field, id)}
                className="text-xs text-blue-600 hover:text-blue-800 flex items-center tooltip"
                disabled={isLoading}
              >
                <span className="tooltip-text">Get AI suggestion</span>
                <i className="fas fa-ai mr-1"></i>
              </button>
            )}
          </div>
          
          {renderInput()}
          
          {/* Display validation error message */}
          {validationError && (
            <p className="text-red-500 text-xs mt-1">{validationError}</p>
          )}
          
          {hasAiSuggestion && isPanelOpen && (
            <div className="mt-2 p-3 bg-blue-50 border border-blue-200 rounded-md">
              <div className="flex justify-between items-start mb-1">
                <span className="text-xs font-medium text-blue-600">AI Suggestion</span>
                <button
                  onClick={() => setShowAiPanel({ ...showAiPanel, [key]: false })}
                  className="text-xs text-gray-500 hover:text-gray-700"
                >
                  <i className="fas fa-times"></i>
                </button>
              </div>
              <p className="text-sm text-gray-700">{aiSuggestions[key]}</p>
              <button
                onClick={() => acceptSuggestion(section, field, id)}
                className="mt-2 px-2 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700"
              >
                <i className="fas fa-check mr-1"></i> Accept Suggestion
              </button>
            </div>
          )}
        </div>
      );
    };
    
    // Create a context for passing validation errors to FormField
    const ValidationContext = React.createContext({});
    
    // Wrap the app with the validation context provider
    const AppWithValidation = () => {
      const [validationErrors, setValidationErrors] = React.useState({});
      
      return (
        <ValidationContext.Provider value={{ validationErrors, setValidationErrors }}>
          <App />
        </ValidationContext.Provider>
      );
    };
    
    // Helper function to format dates
    const formatDate = (dateString) => {
      if (!dateString) return '';
      
      const date = new Date(dateString);
      return date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
    };
    
    // Render the app
    ReactDOM.render(<AppWithValidation />, document.getElementById('root'));
  </script>
</body>
</html>
